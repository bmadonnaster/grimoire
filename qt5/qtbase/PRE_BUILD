# we need an entry for qt5 in /etc/ld.so.conf

if grep -q qt5 /etc/ld.so.conf ;then
    echo /etc/ld.so.conf already contains an entry for qt5
  else
    echo adding entry for qt5 to /etc/ld.so.conf &&
    echo $QT5DIR/lib >> /etc/ld.so.conf &&
    ldconfig
fi &&

default_pre_build    &&
cd $SOURCE_DIRECTORY &&
# Add musl mkspecs if not provided
for i in linux-g++ linux-clang linux-clang-libc++; do
  if ! [ -d mkspecs/"$i"-musl ]; then
    message "Adding mkspec for: $i-musl"
    cp -r mkspecs/"$i" mkspecs/"$i"-musl &&
    sedit '/\/linux\.conf)$/{
		aQMAKE_LIBS_EXECINFO = -lexecinfo
	}' mkspecs/"$i"-musl/qmake.conf || exit 1
  fi
done &&
apply_patch_dir patches
