From 0266415f8382a7e080896ba814d44718cf2cc264 Mon Sep 17 00:00:00 2001
From: Treeve Jelbert <treeve@sourcemage.org>
Date: Mon, 22 May 2017 13:46:44 +0200
Subject: [PATCH 1/4] smgl fixes

---
 src/Makefile.am      | 6 +++---
 src/egl/Makefile.am  | 6 ++++--
 src/glx/Makefile.am  | 3 ++-
 src/mapi/Makefile.am | 6 ++++--
 4 files changed, 13 insertions(+), 8 deletions(-)

diff --git a/src/Makefile.am b/src/Makefile.am
index fd5ae44550..0003325953 100644
--- a/src/Makefile.am
+++ b/src/Makefile.am
@@ -31,7 +31,7 @@ EXTRA_DIST = git_sha1.h.in meson.build
 SUBDIRS = . gtest util mapi/glapi/gen mapi
 
 if HAVE_OPENGL
-gldir = $(includedir)/GL
+gldir = $(includedir)/GL/.mesa
 gl_HEADERS = \
   $(top_srcdir)/include/GL/gl.h \
   $(top_srcdir)/include/GL/glext.h \
@@ -40,7 +40,7 @@ gl_HEADERS = \
 endif
 
 if HAVE_GLX
-glxdir = $(includedir)/GL
+glxdir = $(includedir)/GL/.mesa
 glx_HEADERS = \
   $(top_srcdir)/include/GL/glx.h \
   $(top_srcdir)/include/GL/glxext.h \
@@ -50,7 +50,7 @@ pkgconfig_DATA = mesa/gl.pc
 endif
 
 if HAVE_COMMON_OSMESA
-osmesadir = $(includedir)/GL
+osmesadir = $(includedir)/GL/.mesa
 osmesa_HEADERS = $(top_srcdir)/include/GL/osmesa.h
 endif
 
diff --git a/src/egl/Makefile.am b/src/egl/Makefile.am
index 086a4a1e63..5c0268c672 100644
--- a/src/egl/Makefile.am
+++ b/src/egl/Makefile.am
@@ -165,7 +165,8 @@ AM_CFLAGS += \
 vendorjsondir = @LIBGLVND_DATADIR@/glvnd/egl_vendor.d
 vendorjson_DATA = main/50_mesa.json
 
-lib_LTLIBRARIES = libEGL_mesa.la
+egllibdir = ${libdir}/.mesa
+egllib_LTLIBRARIES = libEGL_mesa.la
 libEGL_mesa_la_SOURCES = \
 	main/eglglvnd.c \
 	main/egldispatchstubs.h \
@@ -184,7 +185,8 @@ libEGL_mesa_la_LDFLAGS = \
 
 else # USE_LIBGLVND
 
-lib_LTLIBRARIES = libEGL.la
+egllibdir = ${libdir}/.mesa
+egllib_LTLIBRARIES = libEGL.la
 libEGL_la_SOURCES =
 libEGL_la_LIBADD = \
 	libEGL_common.la \
diff --git a/src/glx/Makefile.am b/src/glx/Makefile.am
index 5233257fb4..7700ef8c7d 100644
--- a/src/glx/Makefile.am
+++ b/src/glx/Makefile.am
@@ -50,7 +50,8 @@ AM_CFLAGS = \
 	$(GLPROTO_CFLAGS) \
 	$(X11_INCLUDES)
 
-lib_LTLIBRARIES = lib@GL_LIB@.la
+gldir = ${libdir}/.mesa
+gl_LTLIBRARIES = lib@GL_LIB@.la
 
 noinst_LTLIBRARIES = libglx.la
 
diff --git a/src/mapi/Makefile.am b/src/mapi/Makefile.am
index 3da1a193d2..be473fe7cb 100644
--- a/src/mapi/Makefile.am
+++ b/src/mapi/Makefile.am
@@ -178,7 +178,8 @@ GLES_include_HEADERS = \
 	$(top_srcdir)/include/GLES/glext.h \
 	$(top_srcdir)/include/GLES/glplatform.h
 
-lib_LTLIBRARIES += es1api/libGLESv1_CM.la
+glesdir = ${libdir}/.mesa
+gles_LTLIBRARIES = es1api/libGLESv1_CM.la
 
 es1api_libGLESv1_CM_la_SOURCES = entry.c es1api/glapi_mapi_tmp.h
 es1api_libGLESv1_CM_la_CFLAGS = \
@@ -223,7 +224,8 @@ GLES3_include_HEADERS = \
 	$(top_srcdir)/include/GLES3/gl3ext.h \
 	$(top_srcdir)/include/GLES3/gl3platform.h
 
-lib_LTLIBRARIES += es2api/libGLESv2.la
+gles2dir = ${libdir}/.mesa
+gles2_LTLIBRARIES = es2api/libGLESv2.la
 
 es2api_libGLESv2_la_SOURCES = entry.c es2api/glapi_mapi_tmp.h
 es2api_libGLESv2_la_CFLAGS = \
-- 
2.17.0

