From 46bf40229b6f4c59697d8944d7a0a0b98d4ef9b9 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Petr=20Van=C4=9Bk?= <arkamar@atlas.cz>
Date: Tue, 28 May 2019 22:47:48 +0200
Subject: [PATCH 1/6] add secure_getenv function

This function is a GNU extension introduced in glibc 2.17.

Signed-off-by: Ismael Luceno <ismael@iodev.co.uk>
---
 include/stdlib.h        | 1 +
 src/env/secure_getenv.c | 8 ++++++++
 2 files changed, 9 insertions(+)
 create mode 100644 src/env/secure_getenv.c

diff --git a/include/stdlib.h b/include/stdlib.h
index 42ca83363877..194c20339ecd 100644
--- a/include/stdlib.h
+++ b/include/stdlib.h
@@ -152,6 +152,7 @@ int ptsname_r(int, char *, size_t);
 char *ecvt(double, int, int *, int *);
 char *fcvt(double, int, int *, int *);
 char *gcvt(double, int, char *);
+char *secure_getenv(const char *);
 struct __locale_struct;
 float strtof_l(const char *__restrict, char **__restrict, struct __locale_struct *);
 double strtod_l(const char *__restrict, char **__restrict, struct __locale_struct *);
diff --git a/src/env/secure_getenv.c b/src/env/secure_getenv.c
new file mode 100644
index 000000000000..72322f811baa
--- /dev/null
+++ b/src/env/secure_getenv.c
@@ -0,0 +1,8 @@
+#define _GNU_SOURCE
+#include <stdlib.h>
+#include "libc.h"
+
+char *secure_getenv(const char *name)
+{
+	return libc.secure ? NULL : getenv(name);
+}
-- 
2.22.0

