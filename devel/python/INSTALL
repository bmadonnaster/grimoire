make install DESTDIR="$INSTALL_ROOT" &&

if [[ -f "$SOURCE_DIRECTORY/spell-tmp/pydcop.py" ]]; then
  cp "$SOURCE_DIRECTORY/spell-tmp/pydcop.py" "$PYPATH"
fi &&

# gettext
install -vm 755 "$SOURCE_DIRECTORY"/Tools/i18n/{pygettext.py,msgfmt.py} \
                "$INSTALL_ROOT/usr/bin" &&

local PYVER=`echo ${VERSION}|cut -d . -f 1,2` &&

# Ensure existence of /usr/bin/python2 and /usr/bin/python2-config
# symlinks, as they are not created with altinstall.
# See https://mail.python.org/pipermail/python-dev/2011-March/108971.html
# and the surrounding thread for fun.
ln -sf "${TRACK_ROOT}/usr/bin/python$PYVER" "$INSTALL_ROOT/usr/bin/python" || true # always fails?
ln -sf "${TRACK_ROOT}/usr/bin/python$PYVER" "$INSTALL_ROOT/usr/bin/python2" &&
ln -sf "${TRACK_ROOT}/usr/bin/python$PYVER-config" "$INSTALL_ROOT/usr/bin/python2-config" &&

if [ -d "${INSTALL_ROOT}/usr/lib/python${PYVER}/plat-linux2" ];then
   cp -r "${INSTALL_ROOT}/usr/lib/python${PYVER}/plat-linux2" \
   "${INSTALL_ROOT}/usr/lib/python${PYVER}/plat-linux3"
elif [ -d "${INSTALL_ROOT}/usr/lib/python${PYVER}/plat-linux3" ] ; then
   cp -r "${INSTALL_ROOT}/usr/lib/python${PYVER}/plat-linux3" \
   "${INSTALL_ROOT}/usr/lib/python${PYVER}/plat-linux2"
fi
